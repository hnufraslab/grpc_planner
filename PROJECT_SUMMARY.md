# é¡¹ç›®é‡æ„æ€»ç»“

## å®Œæˆæƒ…å†µ

âœ… æ‰€æœ‰æ–‡ä»¶å·²æˆåŠŸåˆ›å»ºå¹¶é…ç½®å®Œæˆï¼

## åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨

```
grpc_planner/
â”œâ”€â”€ planner.proto              # Protobuf æœåŠ¡å®šä¹‰ï¼ˆ4ä¸ªæ¥å£ï¼‰
â”œâ”€â”€ planner_service.h          # C++ æœåŠ¡ç±»å¤´æ–‡ä»¶
â”œâ”€â”€ planner_service.cpp        # C++ æœåŠ¡ç±»å®ç°ï¼ˆ392è¡Œï¼‰
â”œâ”€â”€ grpc_server.cpp            # gRPC æœåŠ¡å™¨ä¸»ç¨‹åº
â”œâ”€â”€ grpc_client.py             # Python å®¢æˆ·ç«¯ç¤ºä¾‹
â”œâ”€â”€ CMakeLists.txt             # CMake æ„å»ºé…ç½®
â”œâ”€â”€ build.sh                   # ä¸€é”®ç¼–è¯‘è„šæœ¬ âœ“ å¯æ‰§è¡Œ
â”œâ”€â”€ run_server.sh              # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬ âœ“ å¯æ‰§è¡Œ
â”œâ”€â”€ README.md                  # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md              # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â””â”€â”€ PROJECT_SUMMARY.md         # æœ¬æ–‡ä»¶
```

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### âœ… æ¥å£ 1: UpdatePointCloud
- è¾“å…¥ï¼šç‚¹äº‘æ•°æ®ï¼ˆæ‰å¹³æ•°ç»„ï¼‰
- åŠŸèƒ½ï¼šæ›´æ–° NURBS æ›²é¢çš„ç‚¹äº‘å¹¶é‡æ–°æ‹Ÿåˆ
- å®ç°ä½ç½®ï¼š`planner_service.cpp:93-130`

### âœ… æ¥å£ 2: ConvertToMesh
- è¾“å…¥ï¼šé‡‡æ ·åˆ†è¾¨ç‡
- è¾“å‡ºï¼šä¸‰è§’ç½‘æ ¼ï¼ˆæ¯ä¸ªä¸‰è§’å½¢9ä¸ªå€¼ï¼‰
- å®ç°ä½ç½®ï¼š`planner_service.cpp:136-172`

### âœ… æ¥å£ 3: GetClosestPoint
- è¾“å…¥ï¼šä¸‰ç»´åæ ‡ (x, y, z)
- è¾“å‡ºï¼šæ›²é¢æœ€è¿‘ç‚¹åæ ‡ + UV å‚æ•°
- å®ç°ä½ç½®ï¼š`planner_service.cpp:178-193`

### âœ… æ¥å£ 4: PlanTrajectory
- è¾“å…¥ï¼šèµ·ç‚¹UVã€ç»ˆç‚¹UVã€é‡‡æ ·æ•°ã€è¶…æ—¶æ—¶é—´
- è¾“å‡ºï¼šè½¨è¿¹ç‚¹ï¼ˆä½ç½®+å§¿æ€+æ³•å‘ï¼‰
- ç®—æ³•ï¼šPCS-FMT è§„åˆ’å™¨
- ç¢°æ’æ£€æµ‹ï¼šMuJoCo å…¨çœŸç¢°æ’
- å®ç°ä½ç½®ï¼š`planner_service.cpp:199-366`

## æŠ€æœ¯ç‰¹ç‚¹

### ğŸš€ æ€§èƒ½ä¼˜åŒ–
- **é›¶æ‹·è´ä¼ è¾“**ï¼šProtobuf äºŒè¿›åˆ¶æ ¼å¼
- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨ std::mutex ä¿æŠ¤å…±äº«èµ„æº
- **é«˜æ•ˆè§„åˆ’**ï¼šPCS-FMT ç®—æ³• + è‡ªé€‚åº”è¿åŠ¨éªŒè¯å™¨

### ğŸ”§ æ¶æ„è®¾è®¡
- **æœåŠ¡åˆ†ç¦»**ï¼šæ ¸å¿ƒé€»è¾‘ä¸ gRPC å±‚è§£è€¦
- **å¾ªç¯è¿è¡Œ**ï¼šæœåŠ¡å™¨æŒç»­ç›‘å¬ï¼Œæ— éœ€é‡å¯
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œé”™è¯¯æ¶ˆæ¯

### ğŸŒ è·¨è¯­è¨€æ”¯æŒ
- C++ æœåŠ¡å™¨ï¼ˆé«˜æ€§èƒ½ï¼‰
- Python å®¢æˆ·ç«¯ï¼ˆæ˜“ç”¨æ€§ï¼‰
- å¯æ‰©å±•åˆ° Goã€Javaã€Node.js ç­‰

## ä¸åŸå§‹ä»£ç å¯¹æ¯”

| ç‰¹æ€§ | PcsFmtTest.cpp | gRPC æœåŠ¡ |
|------|----------------|-----------|
| è¿è¡Œæ¨¡å¼ | å•æ¬¡æ‰§è¡Œ | æŒç»­è¿è¡Œ |
| ç‚¹äº‘æ›´æ–° | éœ€é‡å¯ | åŠ¨æ€æ›´æ–° |
| æ¥å£æ–¹å¼ | å‘½ä»¤è¡Œ | è¿œç¨‹è°ƒç”¨ |
| å¯è§†åŒ– | GLFW å†…ç½® | å®¢æˆ·ç«¯è´Ÿè´£ |
| è§„åˆ’å™¨ | æ”¯æŒ4ç§ | ä¸“æ³¨ PCS-FMT |
| ç¢°æ’æ£€æµ‹ | MuJoCo | MuJoCoï¼ˆä¿æŒä¸€è‡´ï¼‰|

## ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘
```bash
cd /home/fraslab/zzx/Docker/ompl_docker/grpc_planner
./build.sh
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨æœåŠ¡å™¨
```bash
./run_server.sh
```

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œå®¢æˆ·ç«¯
```bash
python3 grpc_client.py
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```bash
export PCD_FILE="/path/to/pointcloud.pcd"
export MODEL_FILE="/path/to/mujoco_model.xml"
export GRPC_SERVER_ADDRESS="0.0.0.0:50051"
```

### è§„åˆ’å™¨å‚æ•°ï¼ˆå¯åœ¨ä»£ç ä¸­ä¿®æ”¹ï¼‰
- `weights_`: {1.0, 1.0, 1.0, 3.0, 6.0}
- `clip_bound_`: {0.1, 0.9, 0.1, 0.9}
- `link_length_`: 0.96
- `num_samples`: 5000ï¼ˆé»˜è®¤ï¼‰
- `timeout`: 20.0 ç§’ï¼ˆé»˜è®¤ï¼‰

## ä¾èµ–é¡¹æ£€æŸ¥æ¸…å•

### C++ ä¾èµ–
- [x] CMake >= 3.10
- [x] C++17 ç¼–è¯‘å™¨
- [x] gRPC
- [x] Protobuf
- [x] OMPL
- [x] PCL
- [x] Eigen3
- [x] MuJoCo Client

### Python ä¾èµ–
```bash
pip3 install grpcio grpcio-tools numpy
```

## ä¸‹ä¸€æ­¥æ‰©å±•å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
1. æ·»åŠ æ—¥å¿—ç³»ç»Ÿï¼ˆspdlogï¼‰
2. æ·»åŠ æ€§èƒ½ç›‘æ§ï¼ˆè§„åˆ’æ—¶é—´ç»Ÿè®¡ï¼‰
3. æ”¯æŒé…ç½®æ–‡ä»¶ï¼ˆYAML/JSONï¼‰

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
1. å®ç°æµå¼æ¥å£ï¼ˆå®æ—¶è½¨è¿¹æ›´æ–°ï¼‰
2. æ‰¹é‡è§„åˆ’æ¥å£
3. æ·»åŠ å•å…ƒæµ‹è¯•

### é•¿æœŸï¼ˆ2-3ä¸ªæœˆï¼‰
1. Docker å®¹å™¨åŒ–
2. æ”¯æŒå¤šè§„åˆ’å™¨åˆ‡æ¢
3. Web å¯è§†åŒ–ç•Œé¢
4. åˆ†å¸ƒå¼è§„åˆ’ï¼ˆå¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼‰

## æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
```bash
# æµ‹è¯•ç‚¹äº‘æ›´æ–°
python3 -c "from grpc_client import PlannerClient; \
client = PlannerClient(); \
import numpy as np; \
points = np.random.rand(100, 3); \
print(client.update_point_cloud(points))"
```

### æ€§èƒ½æµ‹è¯•
```bash
# æµ‹è¯•è§„åˆ’æ€§èƒ½
time python3 grpc_client.py
```

### å‹åŠ›æµ‹è¯•
```python
# å¹¶å‘æµ‹è¯•
import concurrent.futures
from grpc_client import PlannerClient

def test_plan():
    client = PlannerClient()
    return client.plan_trajectory(0.2, 0.2, 0.8, 0.8)

with concurrent.futures.ThreadPoolExecutor(max_workers=10) as executor:
    futures = [executor.submit(test_plan) for _ in range(100)]
    results = [f.result() for f in futures]
```

## å¸¸è§é—®é¢˜è§£å†³

### ç¼–è¯‘é—®é¢˜
- æ‰¾ä¸åˆ° gRPCï¼šå®‰è£… libgrpc++-dev
- æ‰¾ä¸åˆ° OMPLï¼šæ£€æŸ¥ OMPL å®‰è£…è·¯å¾„
- é“¾æ¥é”™è¯¯ï¼šæ£€æŸ¥ä¾èµ–åº“ç‰ˆæœ¬å…¼å®¹æ€§

### è¿è¡Œé—®é¢˜
- ç«¯å£å ç”¨ï¼šä¿®æ”¹ GRPC_SERVER_ADDRESS
- ç‚¹äº‘åŠ è½½å¤±è´¥ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæ ¼å¼
- è§„åˆ’å¤±è´¥ï¼šå¢åŠ  num_samples æˆ– timeout

## æ–‡æ¡£ç´¢å¼•

- **å¿«é€Ÿå¼€å§‹**: [QUICKSTART.md](QUICKSTART.md)
- **å®Œæ•´æ–‡æ¡£**: [README.md](README.md)
- **API å‚è€ƒ**: è§ README.md çš„"æ¥å£è¯¦ç»†è¯´æ˜"ç« èŠ‚
- **å®¢æˆ·ç«¯ç¤ºä¾‹**: [grpc_client.py](grpc_client.py)

## è´¡çŒ®è€…

- åŸå§‹ä»£ç ï¼šPcsFmtTest.cpp
- é‡æ„è®¾è®¡ï¼šåŸºäº gRPC + pybind11 æ–¹æ¡ˆ
- å®ç°æ—¥æœŸï¼š2026-02-04

## ç‰ˆæœ¬å†å²

- v1.0.0 (2026-02-04)
  - åˆå§‹ç‰ˆæœ¬
  - å®ç° 4 ä¸ªæ ¸å¿ƒæ¥å£
  - æ”¯æŒ PCS-FMT è§„åˆ’å™¨
  - Python å®¢æˆ·ç«¯ç¤ºä¾‹

---

**é¡¹ç›®çŠ¶æ€**: âœ… å·²å®Œæˆï¼Œå¯æŠ•å…¥ä½¿ç”¨

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: è¿è¡Œ `./build.sh` å¼€å§‹ç¼–è¯‘ï¼
